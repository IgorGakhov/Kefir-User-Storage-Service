# Kefir User Storage Service

[![linter](https://github.com/IgorGakhov/Kefir-User-Storage-Service/actions/workflows/linter-checker.yml/badge.svg?branch=main)](https://github.com/IgorGakhov/Kefir-User-Storage-Service/actions/workflows/linter-checker.yml) [![Maintainability](https://api.codeclimate.com/v1/badges/444eff433cd4b9b307c4/maintainability)](https://codeclimate.com/github/IgorGakhov/Kefir-User-Storage-Service/maintainability)

*Применяемый стек: Python, FastAPI, Docker, PostgreSQL, SQLAlchemy, Alembic, FastAPI-JWT-Auth, flake8, venv.*

### Содержание
* [Описание](#описание)
* [Установка](#установка)
* [Использование](#использование)
* [Стек проекта и принятые решения](#стек-проекта-и-принятые-решения)

## Описание

**Kefir User Storage Service** - веб-сервис для хранения данных о пользователях. Аутентификация в API на каждый запрос происходит с помощью JWT+cookie. Присутствуют две роли пользователей:
- Администраторы могут видеть все данные пользователей и изменять их.
- Простые пользователи могут видеть лишь ограниченное число данных обо всех
пользователях и редактировать часть своих данных.

Приложение отлавливает все внутренние серверные ошибки и отвечать клиенту в формате JSON с определенным текстом. Все ошибки валидации, авторизации, недостатка прав и т.д. в коде выбрасываются исключениями, исключения обрабатывают общим перехватчиком ошибок.

## Установка

1. Убедитесь, что у вас установлен Python версии 3.8 или выше. Вы можете проверить версию Python, запустив команду в терминале:

```Bash
python --version
```

2. Создайте виртуальное окружение в папке проекта. Для этого перейдите в папку проекта в терминале и выполните команду:

```Bash
python -m venv venv
```

Это создаст папку venv внутри вашего проекта.

3. Активируйте виртуальное окружение, выполнив в терминале команду:

```Bash
# Linux, MacOS:
source venv/bin/activate

# Windows:
venv\Scripts\activate.bat
```

После выполнения этой команды вы увидите, что приглашение терминала изменилось. Это означает, что вы находитесь внутри виртуального окружения.

4. Создайте и заполните файл `.env` по примеру `.env.example`. Для локального запуска в дебаг-режиме достаточно двух переменных:

```Bash
touch .env

# ...
DEBUG=True
AUTH_JWT_SECRET_KEY=some-secret-key
```

5. Установите зависимости в пакет, используя менеджер пакетов pip и файл requirements.txt. Для этого выполните команду:

```Bash
pip install -r requirements.txt
```

6. Накатываем миграции:

```Bash
alembic upgrade head
```

7. Проверьте, что пакет установлен правильно, запустив приложение. Для этого выполните команду:

```Bash
uvicorn src.main:app
```

8. Если вы хотите выйти из виртуального окружения, выполните команду:

```Bash
deactivate
```

После выполнения этой команды приглашение терминала вернется к стандартному виду.

## Использование

Как уже было написано в главе "Установка", запуск скрипта производится из корневой директории проекта командой:

```Bash
uvicorn src.main:app
```

После этого веб-сервис должен быть запущен на локальном сервере и доступен по адресу http://localhost:8000.

Или запустить проект в Докере. Для этого:

1. Дайте разрешение на исполнение скрипта:

```Bash
chmod +x app.sh
```

2. Соберите образ:

```Bash
docker-compose build
```

3. Запустите его:

```Bash
docker-compose up
```

Чтобы ознакомиться с интерактивной документацией, предоставляющей информацию о доступных маршрутах, параметрах запросов, моделях данных и других деталях API, после старта сервера перейдите по ссылке `/docs`.

<image src="docs/kefir-service-ui-screen.png" alt="">

## Стек проекта и принятые решения

Пояснения к решению можете найти в [docs/solution.md](https://github.com/IgorGakhov/Kefir-User-Storage-Service/blob/main/docs/solution.md)

Функцию для заполнения БД фейковыми данными можно найти в черновом файле `docs\fake_db_data_generator.txt`.

___

Благодарю компанию «Кефир» за предоставленное задание.

[![](https://st.renderu.com/image/472402)](https://kefirgames.com/)


**Спасибо за внимание!**

:man_technologist: Автор: [@IgorGakhov](https://github.com/IgorGakhov)
